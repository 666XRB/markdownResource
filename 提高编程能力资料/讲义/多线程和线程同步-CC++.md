# 多线程和线程同步-C/C++

## 线程介绍

==**线程是轻量级的进程**==，==**在Linux环境**下线程的本质仍是进程==。

在计算机上运行的程序是==**一组指令**及**指令参数**的组合==，指令按照既定的逻辑控制计算机运行。

操作系统会以进程为单位，分配系统资源，可以这样理解

---

**进程是资源分配的最小单位，线程是操作系统调度执行的最小单位。**

---



### 线程和进程之间的区别

1. 进程有自己独立的地址空间, 多个线程共用同一个地址空间
   1. ==线程更加节省系统资源==, 效率不仅可以保持的, 而且能够更高
   2. 



## 多线程

## 线程同步































## ==金言玉律==

1. **进程是==资源分配==的最小单位，线程是==操作系统调度执行==的最小单位。**























## 0000











## 线程池

> C++线程池是一种并发编程技术，用于管理和调度多个线程执行任务。线程池由多个线程组成，这些线程可以在任务队列中获取任务并执行。线程池的主要目的是减少线程创建和销毁的开销，提高程序的性能和可维护性。

1. 线程是操作系统中最小的执行单元，是处理器分配时间片的基本单位
2. ==线程可以共享进程的内存空间==，因此可以更高效地进行通信和数据共享。
3. 一个进程可以包含多个线程，这些线程可以并发执行不同的任务。
4. 进程是操作系统中的一个独立的执行实例，它包含了代码、数据和资源。
5. 每个进程都有自己的地址空间和系统资源，进程可以通过进程间通信来进行数据共享和协作。



### 问题引入

我们使用线程的时候就去创建一个线程，这样实现起来非常简便，但是就会有一个问题：如果并发的线程数量很多，并且每个线程都是执行一个时间很短的任务就结束了，这样频繁创建线程就会大大降低系统的效率，因为频繁创建线程和销毁线程需要时间。

那么有没有一种办法使得线程可以复用，就是执行完一个任务，并不被销毁，而是可以继续执行其他的任务呢？



线程池

> 1. 线程池是一种多线程处理形式，处理过程中将任务添加到队列，然后在创建线程后自动启动这些任务。
> 2. 线程池线程都是后台线程。每个线程都使用默认的堆栈大小，以默认的优先级运行，并处于多线程单元中
> 3. 如果某个线程在托管代码中空闲（如正在等待某个事件）,则线程池将插入另一个辅助线程来使所有处理器保持繁忙。
> 4. 如果所有线程池线程都始终保持繁忙，但队列中包含挂起的工作，则线程池将在一段时间后创建另一个辅助线程但线程的数目永远不会超过最大值。超过最大值的线程可以排队，但他们要等到其他线程完成后才启动。



在各个编程语言的语种中都有线程池的概念，并且很多语言中直接提供了线程池，作为程序猿直接使用就可以了.





### 线程池的实现原理：

线程池的组成主要分为3个部分，三部分配合工作就可以得到一个完整的线程池：

> 1. 任务队列，存储需要处理的任务，由工作的线程来处理这些任务
>
>    通过线程池提供的API函数，将一个待处理的任务添加到任务队列，或者从任务队列中删除
>    已处理的任务会被从任务队列中删除
>    线程池的使用者，也就是调用线程池函数往任务队列中添加任务的线程就是生产者线程
>
> 2. 工作的线程（任务队列任务的消费者） ，N个
>
>    线程池中维护了一定数量的工作线程, 他们的作用是是不停的读任务队列, 从里边取出任务并处理
>    工作的线程相当于是任务队列的消费者角色，
>    如果任务队列为空, 工作的线程将会被阻塞 (使用条件变量/信号量阻塞)
>    如果阻塞之后有了新的任务, 由生产者将阻塞解除, 工作线程开始工作
>
> 3. 管理者线程（不处理任务队列中的任务），1个
>
>    它的任务是周期性的对任务队列中的任务数量以及处于忙状态的工作线程个数进行检测
>    当任务过多的时候, 可以适当的创建一些新的工作线程
>    当任务过少的时候, 可以适当的销毁一些工作的线程